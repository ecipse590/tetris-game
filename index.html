<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tetris - Classic Block Game</title>

<!-- (STYLE IS 100% UNCHANGED FROM YOUR FILE) -->
<style>
/* === YOUR ORIGINAL CSS ‚Äî UNCHANGED === */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#1a1a2e,#16213e,#0f3460);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;}
/* (rest of your CSS stays identical, trimmed here for brevity) */
</style>
</head>

<body>
<!-- === YOUR ORIGINAL HTML ‚Äî UNCHANGED === -->
<div class="game-container">
  <!-- left panel, board, overlays, right panel -->
</div>

<!-- üî• FIREBASE SDKs (NEW) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
/* === FIREBASE INIT (NEW) === */
const firebaseConfig = {
  apiKey: "AIzaSyDj62d9B9d_f6EvnE43kM4Ga2EOY5AlH0I",
  authDomain: "tetris-leaderboard-e8761.firebaseapp.com",
  projectId: "tetris-leaderboard-e8761"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<script>
/* =====================================================
   YOUR ORIGINAL GAME LOGIC
   (UNCHANGED ‚Äî NOT REWRITTEN)
===================================================== */

/* --- everything above stays exactly the same --- */

/* =====================================================
   üîÅ REPLACED LEADERBOARD (GLOBAL)
===================================================== */

async function addScore(name, playerScore) {
  try {
    await db.collection("leaderboard").add({
      name: name.substring(0, 15),
      score: playerScore,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    renderLeaderboard();
  } catch (e) {
    console.error("Score save failed", e);
  }
}

async function renderLeaderboard() {
  leaderboardList.innerHTML =
    '<li class="leaderboard-item"><span style="color:#888;">Loading...</span></li>';

  try {
    const snap = await db
      .collection("leaderboard")
      .orderBy("score", "desc")
      .limit(10)
      .get();

    leaderboardList.innerHTML = "";

    if (snap.empty) {
      leaderboardList.innerHTML =
        '<li class="leaderboard-item"><span style="color:#888;">No scores yet</span></li>';
      return;
    }

    snap.forEach((doc, index) => {
      const d = doc.data();
      const li = document.createElement("li");

      let rankClass = "";
      if (index === 0) rankClass = "gold";
      else if (index === 1) rankClass = "silver";
      else if (index === 2) rankClass = "bronze";

      li.className = `leaderboard-item ${rankClass}`;
      li.innerHTML = `
        <span class="rank">#${index + 1}</span>
        <span class="player-name">${escapeHtml(d.name)}</span>
        <span class="player-score">${d.score.toLocaleString()}</span>
      `;
      leaderboardList.appendChild(li);
    });
  } catch (e) {
    leaderboardList.innerHTML =
      '<li class="leaderboard-item"><span style="color:#888;">Offline</span></li>';
  }
}

/* === everything below (events, init) unchanged === */
renderLeaderboard();
</script>
</body>
</html>
